services:
  # ── Backend (Node/Express) ────────────────────────────────────────────────
  - type: web
    name: charity-backend
    env: node
    rootDir: backend
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      # Set the following in the Render dashboard — never commit real values
      - key: MONGODB_URI
        sync: false
      - key: SECRET_STR
        sync: false
      - key: LOGIN_EXPIRE
        value: "2592000"
      - key: SERVER_PORT
        value: "10000"          # Render auto-assigns PORT; this is for URL construction
      - key: SERVER_BASE_URL
        sync: false             # your Render backend URL, e.g. https://charity-backend.onrender.com
      - key: CLIENT_PORT
        value: "443"            # frontend is served on HTTPS (port 443) in production
      - key: ALLOWED_ORIGINS
        sync: false             # e.g. https://charity-frontend.onrender.com
      - key: CLIENT_ID
        sync: false
      - key: CLIENT_SECRET
        sync: false
      - key: REDIRECT_URI
        sync: false
      - key: REFRESH_TOKEN
        sync: false
      - key: SENDING_ADDRESS
        sync: false

  # ── Frontend (Vite/React static site) ─────────────────────────────────────
  - type: web
    name: charity-frontend
    env: static
    rootDir: frontend-v2
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      # Set the following in the Render dashboard
      - key: VITE_BASE_URL
        sync: false             # e.g. https://charity-backend.onrender.com
      - key: VITE_ROLE_ADMIN
        sync: false
      - key: VITE_ROLE_MEMBER
        sync: false
      - key: VITE_ROLE_ORGANIZER
        sync: false
      - key: VITE_ROLE_VOLUNTEER
        sync: false
      - key: VITE_ROLE_PERFORMER
        sync: false
    routes:
      - type: rewrite
        source: /*
        destination: /index.html  # SPA fallback for React Router
